{% extends 'base.html' %}

{% block title %} 
    Suivi de l'épidémie COVID-19 en France : Synthèse des données collectées auprès du milieu hospitalier
{% endblock %}

{% block content %} 

<div class="container" id="data">
    <h2>
        {% if (label != 'France'): %}
            <a href="/#">France</a> &gt; 
        {% endif %} 
        
        {% if (label != 'France'): %}
            {% if (label['type'] == 'department'): %}
                {{ label['prefix'] }} : {{ label['name'] }} (FR-{{ department }})
            {% else : %}
                {{ label['prefix'] }} : {{ label['name'] }} (FR-{{ region }})
            {% endif %}
        {% else : %}
            {{ label }}
        {% endif %} 
    </h2>
    <div class="row">
        <div class="col-md-12">		
            <div class="card mb-4 box-shadow">
                <div class="card-body">
                    {% if (label != 'France'): %}
                        {% if (label['type'] == 'department'): %}
                            <h3>Chiffres clés du {{ counters['last_update_fr']["day"] }} au {{ label['prefix'] }} {{ label['name'] }} (FR-{{ department }})</h3>
                        {% else : %}
                            <h3>Chiffres clés du {{ counters['last_update_fr']["day"] }} à la {{ label['prefix'] }} {{ label['name'] }} (FR-{{ region }})</h3>
                        {% endif %}
                    {% else : %}
                        <h3>Chiffres clés du {{ counters['last_update_fr']["day"] }} en {{ label }}</h3> 
                    {% endif %}
                    <div class="row">
                        <div class="col-md-3">
                            <div class="card mb-4 box-shadow">
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-md-12">
                                            <a href="#patients_décédés_quotidiennement">
                                                <div class="key-indicator-death">
                                                    <span class="key-value">{{ counters['last_dc'] }}</span>
                                                    {% if (counters['last_dc']>1): %}
                                                        <br /> nouveaux décès
                                                    {% else: %}
                                                        <br /> nouveau décès
                                                    {% endif %}
                                                </div>
                                            </a>
                                        </div>
                                        <div class="col-md-12">
                                            <a href="#total_patients_décédés">
                                                <div class="key-indicator-death">
                                                    <span class="key-value">{{ counters['all_dc'] }}</span>
                                                    {% if (counters['all_dc']>1): %}
                                                        <br /> décès au total
                                                    {% else: %}
                                                        <br /> décès au total
                                                    {% endif %}
                                                </div>
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card mb-4 box-shadow">
                                <div class="card-body">
                                    <p align="center">
                                        Les états de santé et les possibles transitions entre elles pour un patient atteint du virus COVID-19
                                    </p>                                
                                    <center> <img src="{{ url_for('static', filename='images/transition.png') }}" height="200" /> </center>
                                </div>
                                <div class="row">
                                    <div class="col-md-6">
                                        <a href="#patients_en_réanimation">
                                            <div class="key-indicator-resuscitation">
                                                <span class="key-value">{{ counters['current_rea'] }}</span>
                                                {% if (counters['current_rea']>1): %}
                                                    <br /> réanimations
                                                {% else: %}
                                                    <br /> réanimation
                                                {% endif %}
                                            </div>
                                        <a/>
                                    </div>
                                    <div class="col-md-6">
                                        <a href="#patients_en_hospitalisation">
                                            <div class="key-indicator-hospitalized">
                                                <span class="key-value">{{ counters['current_hosp'] }}</span>
                                                {% if (counters['current_hosp']>1): %}
                                                    <br /> hospitalisations
                                                {% else: %}
                                                    <br /> hospitalisation
                                                {% endif %}
                                            </div>
                                        <a/>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card mb-4 box-shadow">
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-md-12">
                                            <a href="#patients_guéris_quotidiennement">
                                                <div class="key-indicator-healed">
                                                    <span class="key-value">{{ counters['last_rad'] }}</span>
                                                    {% if (counters['last_rad']>1): %}
                                                        <br /> nouvelles guérisons
                                                    {% else: %}
                                                        <br /> nouvelle guérison
                                                    {% endif %}
                                                </div>
                                            </a>
                                        </div>
                                        <div class="col-md-12">
                                            <a href="#total_patients_guéris">
                                                <div class="key-indicator-healed">
                                                    <span class="key-value">{{ counters['all_rad'] }}</span>
                                                    {% if (counters['all_rad']>1): %}
                                                        <br /> guérisons au total
                                                    {% else: %}
                                                        <br /> guérison au total
                                                    {% endif %}
                                                </div>
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>	
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-12" id="map_view">
            <div class="card mb-4 box-shadow">
                <div class="card-body">
                    <h3>Choix d'un critère à visualiser</h3>
                    <div class="bootstrap-iso">
                        <form method="POST" action="{{ url_for('maps') }}">
                            <div class="form-row align-items-center">
                                <div class="col-auto my-1">
                                    <select name="map_select" class="custom-select mr-sm-2">
                                        {% for m in mapchoice %}
                                            <option value="{{ m }}">{{ m }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                                <div class="col-auto my-1">
                                  <button type="submit" formaction="{{ url_for('maps') }}#map_view" class="btn btn-primary">Valider</button>
                                </div>
                            </div>
                        </form> 
                    </div>
                </div>

                <div class="row">

                    {% if (map_select == "Nombre de décès"): %}

                    <div class="col-md-6" id="death_map_reg">
                        <div class="card mb-4 box-shadow">
                            <div class="card-body">
                                <div class="pictos">
                                    <a class="picto-item" aria-label="Cliquez sur une région pour afficher le détail">
                                        <h3>Nombre de décès à l'hôpital par région *</h3>
                                    </a>
                                </div>
                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="map"></div>
                                    </div>
                                    <div class="col-md-12">
                                        <div class="card mb-4 box-shadow">
                                            <div class="card-body">
                                                <a class="picto-item" aria-label="Sélectionnez les couleurs que vous souhaitez afficher sur la carte">
                                                    <p>Légende</p>
                                                </a>
                                                <div class="areaLegend"></div>
                                                <p style="color:red">&#x26A0 Niveau national : {{ counters['nat_refs']['nat_dc'] }} décès *</p>
                                                <p style="color:black"><small>(* : pour 100 000 habitants)</small></p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6" id="death_map_dep">
                        <div class="card mb-4 box-shadow">
                            <div class="card-body">
                                <div class="pictos">
                                    <a class="picto-item" aria-label="Cliquez sur un département pour afficher le détail">
                                        <h3>Nombre de décès à l'hôpital par département *</h3>
                                    </a>
                                </div>
                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="map"></div>
                                    </div>
                                    <div class="col-md-12">
                                        <div class="card mb-4 box-shadow">
                                            <div class="card-body">
                                                <a class="picto-item" aria-label="Sélectionnez les couleurs que vous souhaitez afficher sur la carte">
                                                    <p>Légende</p>
                                                </a>
                                                <div class="areaLegend"></div>
                                                <p style="color:red">&#x26A0 Niveau national : {{ counters['nat_refs']['nat_dc'] }} décès *</p>
                                                <p style="color:black"><small>(* : pour 100 000 habitants)</small></p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    {% elif (map_select == "Taux décès / (décès + guérisons)"): %}

                    <div class="col-md-6" id="rate_death_map_reg">
                        <div class="card mb-4 box-shadow">
                            <div class="card-body">
                                <div class="pictos">
                                    <a class="picto-item" aria-label="Cliquez sur un département pour afficher le détail">
                                        <h3>Taux décès / (décès + guérisons) par région</h3>
                                    </a>
                                </div>
                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="map"></div>
                                    </div>
                                    <div class="col-md-12">
                                        <div class="card mb-4 box-shadow">
                                            <div class="card-body">
                                                <a class="picto-item" aria-label="Sélectionnez les couleurs que vous souhaitez afficher sur la carte">
                                                    <p>Légende</p>
                                                </a>
                                                <div class="areaLegend"></div>
                                                <p style="color:red">&#x26A0 Taux national : {{ counters['nat_refs']['nat_r_dc_rad'] }}</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6" id="rate_death_map_dep">
                        <div class="card mb-4 box-shadow">
                            <div class="card-body">
                                <div class="pictos">
                                    <a class="picto-item" aria-label="Cliquez sur un département pour afficher le détail">
                                        <h3>Taux décès / (décès + guérisons) par département</h3>
                                    </a>
                                </div>
                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="map"></div>
                                    </div>
                                    <div class="col-md-12">
                                        <div class="card mb-4 box-shadow">
                                            <div class="card-body">
                                                <a class="picto-item" aria-label="Sélectionnez les couleurs que vous souhaitez afficher sur la carte">
                                                    <p>Légende</p>
                                                </a>
                                                <div class="areaLegend"></div>
                                                <p style="color:red">&#x26A0 Taux national : {{ counters['nat_refs']['nat_r_dc_rad'] }}</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    {% elif (map_select == "Nombre de guérisons"): %}

                    <div class="col-md-6" id="rad_map_reg">
                        <div class="card mb-4 box-shadow">
                            <div class="card-body">
                                <div class="pictos">
                                    <a class="picto-item" aria-label="Cliquez sur un département pour afficher le détail">
                                        <h3>Nombre de guérisons à l'hôpital par région *</h3>
                                    </a>
                                </div>
                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="map"></div>
                                    </div>
                                    <div class="col-md-12">
                                        <div class="card mb-4 box-shadow">
                                            <div class="card-body">
                                                <a class="picto-item" aria-label="Sélectionnez les couleurs que vous souhaitez afficher sur la carte">
                                                    <p>Légende</p>
                                                </a>
                                                <div class="areaLegend"></div>
                                                <p style="color:green">&#x26A0 Niveau national : {{ counters['nat_refs']['nat_rad'] }} guérisons *</p>
                                                <p style="color:black"><small>(* : pour 100 000 habitants)</small></p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6" id="rad_map_dep">
                        <div class="card mb-4 box-shadow">
                            <div class="card-body">
                                <div class="pictos">
                                    <a class="picto-item" aria-label="Cliquez sur un département pour afficher le détail">
                                        <h3>Nombre de guérisons à l'hôpital par département *</h3>
                                    </a>
                                </div>
                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="map"></div>
                                    </div>
                                    <div class="col-md-12">
                                        <div class="card mb-4 box-shadow">
                                            <div class="card-body">
                                                <a class="picto-item" aria-label="Sélectionnez les couleurs que vous souhaitez afficher sur la carte">
                                                    <p>Légende</p>
                                                </a>
                                                <div class="areaLegend"></div>
                                                <p style="color:green">&#x26A0 Niveau national : {{ counters['nat_refs']['nat_rad'] }} guérisons *</p>
                                                <p style="color:black"><small>(* : pour 100 000 habitants)</small></p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    {% elif (map_select == "Nombre d'hospitalisations le " + counters['last_update_fr']["day"]): %}

                    <div class="col-md-6" id="hosp_map_reg">
                        <div class="card mb-4 box-shadow">
                            <div class="card-body">
                                <div class="pictos">
                                    <a class="picto-item" aria-label="Cliquez sur un département pour afficher le détail">
                                        <h3>Nombre d'hospitalisations par région le {{ counters['last_update_fr']["day"] }} *
                                    </a>
                                </div>
                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="map"></div>
                                    </div>
                                    <div class="col-md-12">
                                        <div class="card mb-4 box-shadow">
                                            <div class="card-body">
                                                <a class="picto-item" aria-label="Sélectionnez les couleurs que vous souhaitez afficher sur la carte">
                                                    <p>Légende</p>
                                                </a>
                                                <div class="areaLegend"></div>
                                                <p style="color:red">&#x26A0 Niveau national : {{ counters['nat_refs']['nat_hosp'] }} hospitalisations *</p>
                                                <p style="color:black"><small>(* : pour 100 000 habitants)</small></p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6" id="hosp_map_dep">
                        <div class="card mb-4 box-shadow">
                            <div class="card-body">
                                <div class="pictos">
                                    <a class="picto-item" aria-label="Cliquez sur un département pour afficher le détail">
                                        <h3>Nombre d'hospitalisations par département le {{ counters['last_update_fr']["day"] }} *
                                    </a>
                                </div>
                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="map"></div>
                                    </div>
                                    <div class="col-md-12">
                                        <div class="card mb-4 box-shadow">
                                            <div class="card-body">
                                                <a class="picto-item" aria-label="Sélectionnez les couleurs que vous souhaitez afficher sur la carte">
                                                    <p>Légende</p>
                                                </a>
                                                <div class="areaLegend"></div>
                                                <p style="color:red">&#x26A0 Niveau national : {{ counters['nat_refs']['nat_hosp'] }} hospitalisations *</p>
                                                <p style="color:black"><small>(* : pour 100 000 habitants)</small></p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    {% elif (map_select == "Nombre de réanimations le " + counters['last_update_fr']["day"]): %}

                    <div class="col-md-6" id="rea_map_reg">
                        <div class="card mb-4 box-shadow">
                            <div class="card-body">
                                <div class="pictos">
                                    <a class="picto-item" aria-label="Cliquez sur un département pour afficher le détail">
                                        <h3>Nombre de réanimations par région le {{ counters['last_update_fr']["day"] }} *
                                    </a>
                                </div>
                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="map"></div>
                                    </div>
                                    <div class="col-md-12">
                                        <div class="card mb-4 box-shadow">
                                            <div class="card-body">
                                                <a class="picto-item" aria-label="Sélectionnez les couleurs que vous souhaitez afficher sur la carte">
                                                    <p>Légende</p>
                                                </a>
                                                <div class="areaLegend"></div>
                                                <p style="color:red">&#x26A0 Niveau national : {{ counters['nat_refs']['nat_rea'] }} réanimations *</p>
                                                <p style="color:black"><small>(* : pour 100 000 habitants)</small></p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6" id="rea_map_dep">
                        <div class="card mb-4 box-shadow">
                            <div class="card-body">
                                <div class="pictos">
                                    <a class="picto-item" aria-label="Cliquez sur un département pour afficher le détail">
                                        <h3>Nombre de réanimations par département le {{ counters['last_update_fr']["day"] }} *
                                    </a>
                                </div>
                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="map"></div>
                                    </div>
                                    <div class="col-md-12">
                                        <div class="card mb-4 box-shadow">
                                            <div class="card-body">
                                                <a class="picto-item" aria-label="Sélectionnez les couleurs que vous souhaitez afficher sur la carte">
                                                    <p>Légende</p>
                                                </a>
                                                <div class="areaLegend"></div>
                                                <p style="color:red">&#x26A0 Niveau national : {{ counters['nat_refs']['nat_rea'] }} réanimations *</p>
                                                <p style="color:black"><small>(* : pour 100 000 habitants)</small></p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    {% endif %}

                </div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="card mb-4 box-shadow">
                <div class="card-body">
                    {% if (label != 'France'): %}
                        {% if (label['type'] == 'department'): %}
                            <h3 id="patients_en_hospitalisation">Nombre de patients actuellement hospitalisés au {{ label['prefix'] }} {{ label['name'] }} (FR-{{ department }})</h3>
                        {% else : %}
                            <h3 id="patients_en_hospitalisation">Nombre de patients actuellement hospitalisés à la {{ label['prefix'] }} {{ label['name'] }} (FR-{{ region }})</h3></h3>
                        {% endif %}
                    {% else : %}
                        <h3 id="patients_en_hospitalisation">Nombre de patients actuellement hospitalisés en {{ label }}</h3>
                    {% endif %}
                    <div id="Nombre de personnes actuellement hospitalisées"></div>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card mb-4 box-shadow">
                <div class="card-body">
                    {% if (label != 'France'): %}
                        {% if (label['type'] == 'department'): %}
                            <h3 id="patients_en_réanimation">Nombre de patients actuellement en réanimation au {{ label['prefix'] }} {{ label['name'] }} (FR-{{ department }})</h3>
                        {% else : %}
                            <h3 id="patients_en_réanimation">Nombre de patients actuellement en réanimation à la {{ label['prefix'] }} {{ label['name'] }} (FR-{{ region }})</h3>
                        {% endif %}
                    {% else : %}
                        <h3 id="patients_en_réanimation">Nombre de patients actuellement en réanimation en {{ label }}</h3>
                    {% endif %}
                    <div id="Nombre de personnes actuellement en réanimation"></div>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card mb-4 box-shadow">
                <div class="card-body">
                    {% if (label != 'France'): %}
                        {% if (label['type'] == 'department'): %}
                            <h3 id="total_patients_décédés">Nombre cumulé de patients décédés à l'hôpital au {{ label['prefix'] }} {{ label['name'] }} (FR-{{ department }})</h3>
                        {% else : %}
                            <h3 id="total_patients_décédés">Nombre cumulé de patients décédés à l'hôpital à la {{ label['prefix'] }} {{ label['name'] }} (FR-{{ région }})</h3>
                        {% endif %}
                    {% else : %}
                        <h3 id="total_patients_décédés">Nombre cumulé de patients décédés à l'hôpital en {{ label }}</h3>
                    {% endif %}
                    <div id="Nombre cumulé de personnes décédées à l'hôpital"></div>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card mb-4 box-shadow">
                <div class="card-body">
                    {% if (label != 'France'): %}
                        {% if (label['type'] == 'department'): %}
                            <h3 id="total_patients_guéris">Nombre cumulé de patients retournés à domicile au {{ label['prefix'] }} {{ label['name'] }} (FR-{{ department }})</h3>
                        {% else : %}
                            <h3 id="total_patients_guéris">Nombre cumulé de patients retournés à domicile à la {{ label['prefix'] }} {{ label['name'] }} (FR-{{ region }})</h3>
                        {% endif %}
                    {% else : %}
                        <h3 id="total_patients_guéris">Nombre cumulé de patients retournés à domicile en {{ label }}</h3>
                    {% endif %}
                    <div id="Nombre cumulé de personnes retournées à domicile"></div>
                </div>
            </div>
        </div>
        <div class="col-md-12">
            <div class="card mb-4 box-shadow">
                <div class="card-body">
                    {% if (label != 'France'): %}
                        {% if (label['type'] == 'department'): %}
                            <h3 id="patients_décédés_quotidiennement">Nombre quotidien de patients décédés à l'hôpital au {{ label['prefix'] }} {{ label['name'] }} (FR-{{ department }})</h3>
                        {% else : %}
                            <h3 id="patients_décédés_quotidiennement">Nombre quotidien de patients décédés à l'hôpital à la {{ label['prefix'] }} {{ label['name'] }} (FR-{{ region }})</h3>
                        {% endif %}
                    {% else : %}
                        <h3 id="patients_décédés_quotidiennement">Nombre quotidien de patients décédés à l'hôpital en {{ label }}</h3> 
                    {% endif %}
                    <div id="Nombre de personnes décédées par jour à l'hôpital"></div>
                </div>
            </div>
        </div>
        <div class="col-md-12">
            <div class="card mb-4 box-shadow">
                <div class="card-body">
                    {% if (label != 'France'): %}
                        {% if (label['type'] == 'department'): %}
                            <h3 id="patients_guéris_quotidiennement">Nombre quotidien de patients retournés à domicile au {{ label['prefix'] }} {{ label['name'] }} (FR-{{ department }})</h3>
                        {% else : %}
                            <h3 id="patients_guéris_quotidiennement">Nombre quotidien de patients retournés à domicile à la {{ label['prefix'] }} {{ label['name'] }} (FR-{{ region }})</h3>
                        {% endif %}
                    {% else : %}
                        <h3 id="patients_guéris_quotidiennement">Nombre quotidien de patients retournés à domicile en {{ label }}</h3> 
                    {% endif %}
                    <div id="Nombre de personnes retournées par jour à domicile"></div>
                </div>
            </div>
        </div>

        <div class="col-md-12" id="global_monitoring_results">
            <div class="card mb-4 box-shadow">
                <div class="card-body">
                    <h3>Suivi global de la situation épidémique en France</h3>
                    <div class="bootstrap-iso">
                        <form method="POST" action="{{ url_for('global_monitoring_settings') }}">
                            <div class="form-row align-items-center">
                                <div class="col-auto my-1">
                                    <label class="mr-sm-2" for="inlineFormCustomSelect">pc number</label>
                                    <select name="global_parameters" class="custom-select mr-sm-2">
                                        {% for pc in global_pc %}
                                            {% if (pc == 2): %}
                                                <option selected="selected">2</option> 
                                            {% else %}
                                                <option value="{{ pc }}">{{ pc }}</option>
                                            {% endif %}
                                        {% endfor %}
                                    </select>
                                </div>

                                <div class="col-auto my-1">
                                    <label class="mr-sm-2" for="inlineFormCustomSelect">data normalization</label>
                                    <select name="global_parameters" class="custom-select mr-sm-2">
                                        {% for b in normalize %}
                                            {% if (b == True): %}
                                                <option selected="selected">True</option> 
                                            {% else %}
                                                <option value="{{ b }}">{{ b }}</option>
                                            {% endif %}
                                        {% endfor %}
                                    </select>
                                </div>

                                <div class="col-auto my-1">
                                    <label class="control-label" for="date">date range (model learning)</label>
                                    <input type="text" class="form-control" data-filter-type="date-range" data-toggle="daterangepicker" name="global_parameters" value="">
                                </div>

                                <div class="col-auto my-1">
                                    <label class="control-label" for="date">smoothing filter</label>
                                    <select name="global_parameters" class="custom-select mr-sm-2">
                                        {% for s in alpha_smooth %}
                                            {% if (s == 0.6): %}
                                                <option selected="selected">0.6</option> 
                                            {% else %}
                                                <option value="{{ s }}">{{ s }}</option>
                                            {% endif %}
                                        {% endfor %}
                                    </select>
                                </div>

                                <div class="col-auto my-1">
                                  <button type="submit" formaction="{{ url_for('global_monitoring_settings') }}#global_monitoring_results" class="btn btn-primary">Valider</button>
                                </div>
                            </div>
                        </form> 
                    </div>
                </div>

                <div class="col-md-12" id="">
                    <div class="card mb-4 box-shadow">
                        <div class="card-body">
                            <h3>Indicateur t</h3>
                            <div id="Hotelling"> </div>
                        </div>
                    </div>
                </div>

                <div class="col-md-12" id="">
                    <div class="card mb-4 box-shadow">
                        <div class="card-body">
                            <h3>Indicateur s</h3>
                            <div id="SPE"> </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-12" id="hosp_monitoring_results">
            <div class="card mb-4 box-shadow">
                <div class="card-body">
                    <h3>Suivi de la situation épidémique en France en surveillant le nombre d'hospitalisations</h3>
                    <div class="bootstrap-iso">
                        <form method="POST" action="{{ url_for('hosp_monitoring_settings') }}">
                            <div class="form-row align-items-center">
                                <div class="col-auto my-1">
                                    <label class="mr-sm-2" for="inlineFormCustomSelect">pc number</label>
                                    <select name="hosp_parameters" class="custom-select mr-sm-2">
                                        {% for pc in pc_reg %}
                                            {% if (pc == 2): %}
                                                <option selected="selected">2</option> 
                                            {% else %}
                                                <option value="{{ pc }}">{{ pc }}</option>
                                            {% endif %}
                                        {% endfor %}
                                    </select>
                                </div>

                                <div class="col-auto my-1">
                                    <label class="mr-sm-2" for="inlineFormCustomSelect">data normalization</label>
                                    <select name="hosp_parameters" class="custom-select mr-sm-2">
                                        {% for b in normalize %}
                                            {% if (b == False): %}
                                                <option selected="selected">False</option> 
                                            {% else %}
                                                <option value="{{ b }}">{{ b }}</option>
                                            {% endif %}
                                        {% endfor %}
                                    </select>
                                </div>

                                <div class="col-auto my-1">
                                    <label class="control-label" for="date">date range (model learning)</label>
                                    <input type="text" class="form-control" data-filter-type="date-range" data-toggle="daterangepicker" name="hosp_parameters" value="">
                                </div>

                                <div class="col-auto my-1">
                                    <label class="control-label" for="date">smoothing filter</label>
                                    <select name="hosp_parameters" class="custom-select mr-sm-2">
                                        {% for s in alpha_smooth %}
                                            {% if (s == 0.6): %}
                                                <option selected="selected">0.6</option> 
                                            {% else %}
                                                <option value="{{ s }}">{{ s }}</option>
                                            {% endif %}
                                        {% endfor %}
                                    </select>
                                </div>

                                <div class="col-auto my-1">
                                    <button type="submit" formaction="{{ url_for('hosp_monitoring_settings') }}#hosp_monitoring_results" class="btn btn-primary">Valider</button>
                                </div>
                            </div>
                        </form> 
                    </div>
                </div>

                <div class="col-md-12" id="">
                    <div class="card mb-4 box-shadow">
                        <div class="card-body">
                            <h3>Indicateur t</h3>
                            <div id="Hotelling_reg"> </div>
                        </div>
                    </div>
                </div>

                <div class="col-md-12" id="">
                    <div class="card mb-4 box-shadow">
                        <div class="card-body">
                            <h3>Indicateur s</h3>
                            <div id="SPE_reg"> </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>

{% endblock %}

{% block js %}

    <script type="text/javascript">
    $(function() {
        $('input[name="global_parameters"]').daterangepicker({
            "showDropdowns": true,
            "autoApply":true,
            "startDate": "14/05/2020",
            "endDate": "14/06/2020",
            "minDate": {{ first_day|safe }},
            "maxDate": {{ last_day|safe }},
            "showCustomRangeLabel":true,
            autoUpdateInput: true,
            locale: {   format: 'DD/MM/YYYY', 
                        daysOfWeek: ['Dim', 'Lun', 'Mar', 'Mer', 'Jeu', 'Ven', 'Sam'],
                        monthNames: ['Janv', 'Févr', 'Mars', 'Avr', 'Mai', 'Juin',
                            'Juill', 'Août', 'Sept', 'Oct', 'Nov', 'Déc'],
                        firstDay: 1},
        });
    });
    </script>

    <script type="text/javascript">
    $(function() {
        $('input[name="hosp_parameters"]').daterangepicker({
            "showDropdowns": true,
            "autoApply":true,
            "startDate": "14/05/2020",
            "endDate": "14/06/2020",
            "minDate": {{ first_day|safe }},
            "maxDate": {{ last_day|safe }},   
            "showCustomRangeLabel":true,
            autoUpdateInput: true,
            locale: {   format: 'DD/MM/YYYY', 
                        daysOfWeek: ['Dim', 'Lun', 'Mar', 'Mer', 'Jeu', 'Ven', 'Sam'],
                        monthNames: ['Janv', 'Févr', 'Mars', 'Avr', 'Mai', 'Juin',
                            'Juill', 'Août', 'Sept', 'Oct', 'Nov', 'Déc'],
                        firstDay: 1},
        });
    });
    </script>

    <!-- death map regions-->
    <script type="text/javascript">
        $(function() {
            // Init map
            var regions = {{ overall_regions_data_dc|safe }};
            var quantiles = {{ overall_regions_quantiles_dc|safe }};
            quantiles = Object.values(quantiles);
            var slices = [
                    {"max": quantiles[0], "label": "Moins de " + quantiles[0] + " décès *", attrs: {fill: "#D6F77F"}}
                ];
            colors = ["#f2f53a", '#df891a', '#e61919', '#680000', '#1d0303']
            for (var i = 0; i < quantiles.length; i++) {
                var slice = {
                        attrs: {
                            fill: colors[i]
                        }
                    };
                slice.min = quantiles[i];
                if (i < quantiles.length -1) {
                    slice.max = quantiles[i + 1];
                    slice.label = "Entre " + slice.min + " et " + slice.max + " décès *";
                } else {
                    slice.label = "Plus de " + slice.min + " décès *";
                }
                slices.push(slice);
            }
            for (var id in regions) {
                regions[id]['value'] = regions[id]['dc_par_habitants'];
                regions[id]['tooltip'] = {
                    "content": regions[id]['label'] + " : <b>" + regions[id]['dc'] + "</b> décès (<b>" + regions[id]['dc_par_habitants'] + "</b> pour 100 000 habitants)"
                };
                regions[id]['href'] = "/region/" + regions[id]['insee'] + "#";
                if (regions[id]['insee'] === '{{ region }}') {
                    regions[id]['href'] = "/";
                    delete regions[id]['value'];
                    regions[id]['attrs'] = {
                        "fill": "#004a9b",
                    };
                }
            }
            $("#death_map_reg").mapael({
                "map": {
                    "name": "france_regions_2016_domtom",
                    zoom: {
                        enabled: true,
                        maxLevel: 10
                    },
                    "defaultArea": {
                        "attrs": {
                            "fill": "#f4f4e8",
                            "stroke": "#ced8d0",
                        },
                        "attrsHover": {
                            "fill": "#004a9b",
                        },
                        "text": {
                            "attrs": {
                                "fill": "#505444"
                            },
                            "attrsHover": {
                                "fill": "#000",
                            }
                        }
                    }
                },
                "legend": {
                    "area": {
                        "marginBottom": 20,
                        "slices": slices,
                    }
                },
                "areas": regions
            });
        });
    </script>

    <!-- rate dc map regions -->
    <script type="text/javascript">
        $(function() {
            // Init map
            var regions = {{ overall_regions_data_r_dc_rad|safe }};
            var quantiles = {{ overall_regions_quantiles_r_dc_rad|safe }};
            quantiles = Object.values(quantiles);
            var slices = [
                    {"max": quantiles[0], "label": "Taux inférieur à " + quantiles[0], attrs: {fill: '#D6F77F'}}
                ];
            colors = ["#f2f53a", '#df891a', '#e61919', '#680000', '#1d0303'] 
            for (var i = 0; i < quantiles.length; i++) {
                var slice = {
                        attrs: {
                            fill: colors[i]
                        }
                    };
                slice.min = quantiles[i];
                if (i < quantiles.length -1) {
                    slice.max = quantiles[i + 1];
                    slice.label = "Taux entre " + slice.min + " et " + slice.max;
                } else {
                    slice.label = "Taux supérieur à " + slice.min;
                }
                slices.push(slice);
            }
            for (var id in regions) {
                regions[id]['value'] = regions[id]['r_dc_rad'];
                regions[id]['tooltip'] = {
                    "content": regions[id]['label'] + " : <b>" + regions[id]['dc'] + "</b> décès, <b>" + regions[id]['rad'] + "</b> guérisons (Taux régional : <b>" + regions[id]['r_dc_rad'] + "</b>)"
                };
                regions[id]['href'] = "/region/" + regions[id]['insee'] + "#"; 
                if (regions[id]['insee'] === '{{ region }}') {
                    regions[id]['href'] = "/";
                    delete regions[id]['value'];
                    regions[id]['attrs'] = {
                        "fill": "#004a9b", 
                    };
                }
            }      
            $("#rate_death_map_reg").mapael({
                "map": {
                    "name": "france_regions_2016_domtom",
                    zoom: {
                        enabled: true,
                        maxLevel: 10
                    },  
                    "defaultArea": {
                        "attrs": {
                            "fill": "#f4f4e8",
                            "stroke": "#ced8d0",
                        },
                        "attrsHover": {
                            "fill": "#004a9b",
                        },
                        "text": {
                            "attrs": {
                                "fill": "#505444"
                            },
                            "attrsHover": {
                                "fill": "#000",
                            }
                        }
                    }   
                },
                "legend": {
                    "area": {
                        "marginBottom": 20,
                        "slices": slices
                    }
                },
                "areas": regions
            });
        });
    </script>

    <!-- rad map regions-->
    <script type="text/javascript">
        $(function() {
            // Init map
            var regions = {{ overall_regions_data_rad|safe }};
            var quantiles = {{ overall_regions_quantiles_rad|safe }};
            quantiles = Object.values(quantiles);
            var slices = [
                {"max": quantiles[0], "label": "Moins de " + quantiles[0] + " guérisons *", attrs: {fill: "#FEB653"}}
                ];
            colors = ["#FED674", '#F5F50A', '#A4F905', '#06BF06', '#146806']  
            for (var i = 0; i < quantiles.length; i++) {
                var slice = {
                        attrs: {
                            fill: colors[i]
                        }
                    };
                slice.min = quantiles[i];
                if (i < quantiles.length -1) {
                    slice.max = quantiles[i + 1];
                    slice.label = "Entre " + slice.min + " et " + slice.max + " guérisons *";
                } else {
                    slice.label = "Plus de " + slice.min + " guérisons *";
                }
                slices.push(slice);
            }
            for (var id in regions) {
                regions[id]['value'] = regions[id]['rad_par_habitants'];
                regions[id]['tooltip'] = {
                    "content": regions[id]['label'] + " : <b>" + regions[id]['rad'] + "</b> guérisons (<b>" + regions[id]['rad_par_habitants'] + "</b> pour 100 000 habitants)"
                };
                regions[id]['href'] = "/region/" + regions[id]['insee'] + "#"; 
                if (regions[id]['insee'] === '{{ region }}') {
                    regions[id]['href'] = "/";
                    delete regions[id]['value'];
                    regions[id]['attrs'] = {
                        "fill": "#004a9b", 
                    };
                }
            }   
            $("#rad_map_reg").mapael({
                "map": {
                    "name": "france_regions_2016_domtom",
                    zoom: {
                        enabled: true,
                        maxLevel: 10
                    },
                
                    "defaultArea": {
                        "attrs": {
                            "fill": "#f4f4e8",
                            "stroke": "#ced8d0",
                        },
                        "attrsHover": {
                            "fill": "#004a9b",
                        },
                        "text": {
                            "attrs": {
                                "fill": "#505444"
                            },
                            "attrsHover": {
                                "fill": "#000",
                            }
                        }
                    }   
                },
                "legend": {
                    "area": {
                        "marginBottom": 20,
                        "slices": slices
                    }
                },
                "areas": regions
            });
        });
    </script>

    <!-- hosp map regions-->
    <script type="text/javascript">
        $(function() {
            // Init map
            var regions = {{ overall_regions_data_hosp|safe }};
            var quantiles = {{ overall_regions_quantiles_hosp|safe }};
            quantiles = Object.values(quantiles);
            var slices = [
                    {"max": quantiles[0], "label": "Moins de " + quantiles[0] + " hospitalisations *", attrs: {fill: "#D6F77F"}}
                ];
            colors = ["#f2f53a", '#df891a', '#e61919', '#680000', '#1d0303']
            for (var i = 0; i < quantiles.length; i++) {
                var slice = {
                        attrs: {
                            fill: colors[i]
                        }
                    };
                slice.min = quantiles[i];
                if (i < quantiles.length -1) {
                    slice.max = quantiles[i + 1];
                    slice.label = "Entre " + slice.min + " et " + slice.max + " hospitalisations *";
                } else {
                    slice.label = "Plus de " + slice.min + " hospitalisations *";
                }
                slices.push(slice);
            }
            for (var id in regions) {
                regions[id]['value'] = regions[id]['hosp_par_habitants'];
                regions[id]['tooltip'] = {
                    "content": regions[id]['label'] + " : <b>" + regions[id]['hosp'] + "</b> hospitalisations (<b>" + regions[id]['hosp_par_habitants'] + "</b> pour 100 000 habitants)"
                };
                regions[id]['href'] = "/region/" + regions[id]['insee'] + "#"; 
                if (regions[id]['insee'] === '{{ region }}') {
                    regions[id]['href'] = "/";
                    delete regions[id]['value'];
                    regions[id]['attrs'] = {
                        "fill": "#004a9b", 
                    };
                }
            }        
            $("#hosp_map_reg").mapael({
                "map": {
                    "name": "france_regions_2016_domtom",
                    zoom: {
                        enabled: true,
                        maxLevel: 10
                    },      
                    "defaultArea": {
                        "attrs": {
                            "fill": "#f4f4e8",
                            "stroke": "#ced8d0",
                        },
                        "attrsHover": {
                            "fill": "#004a9b",
                        },
                        "text": {
                            "attrs": {
                                "fill": "#505444"
                            },
                            "attrsHover": {
                                "fill": "#000",
                            }
                        }
                    }   
                },          
                "legend": {
                    "area": {
                        "marginBottom": 20,
                        "slices": slices
                    }
                },
                "areas": regions
            });
        });
    </script>

    <!-- rea map regions-->
    <script type="text/javascript">
        $(function() {
            // Init map
            var regions = {{ overall_regions_data_rea|safe }};
            var quantiles = {{ overall_regions_quantiles_rea|safe }};
            quantiles = Object.values(quantiles);
            var slices = [
                    {"max": quantiles[0], "label": quantiles[0] + " réanimations *", attrs: {fill: "#D6F77F"}}
                ];
            colors = ["#f2f53a", '#df891a', '#e61919', '#680000', '#1d0303']
            for (var i = 0; i < quantiles.length; i++) {
                var slice = {
                        attrs: {
                            fill: colors[i]
                        }
                    };
                slice.min = quantiles[i];
                if (i < quantiles.length -1) {
                    slice.max = quantiles[i + 1];
                    slice.label = "Entre " + slice.min + " et " + slice.max + " réanimations *";
                } else {
                    slice.label = "Plus de " + slice.min + " réanimations *";
                }
                if (i == 0) {
                    slice.max = quantiles[i + 1];
                    slice.label = "Moins de " + slice.max + " réanimations *";
                }           
                slices.push(slice);
            }
            for (var id in regions) {
                regions[id]['value'] = regions[id]['rea_par_habitants'];
                regions[id]['tooltip'] = {
                    "content": regions[id]['label'] + " : <b>" + regions[id]['rea'] + "</b> réanimations (<b>" + regions[id]['rea_par_habitants'] + "</b> pour 100 000 habitants)"
                };
                regions[id]['href'] = "/region/" + regions[id]['insee'] + "#"; 
                if (regions[id]['insee'] === '{{ region }}') {
                    regions[id]['href'] = "/";
                    delete regions[id]['value'];
                    regions[id]['attrs'] = {
                        "fill": "#004a9b", 
                    };
                }
            }       
            $("#rea_map_reg").mapael({
                "map": {
                    "name": "france_regions_2016_domtom",
                    zoom: {
                        enabled: true,
                        maxLevel: 10
                    },                  
                    "defaultArea": {
                        "attrs": {
                            "fill": "#f4f4e8",
                            "stroke": "#ced8d0",
                        },
                        "attrsHover": {
                            "fill": "#004a9b",
                        },
                        "text": {
                            "attrs": {
                                "fill": "#505444"
                            },
                            "attrsHover": {
                                "fill": "#000",
                            }
                        }
                    }   
                },  
                "legend": {
                    "area": {
                        "marginBottom": 20,
                        "slices": slices
                    }
                },
                "areas": regions
            });
        });
    </script>

    <!-- death map departments-->
    <script type="text/javascript">
        $(function() {
            // Init map
            var departments = {{ overall_departments_data_dc|safe }};
            var quantiles = {{ overall_departments_quantiles_dc|safe }};
            quantiles = Object.values(quantiles);
            var slices = [
                    {"max": quantiles[0], "label": "Moins de " + quantiles[0] + " décès *", attrs: {fill: "#D6F77F"}}
                ];
            colors = ["#f2f53a", '#df891a', '#e61919', '#680000', '#1d0303']
            for (var i = 0; i < quantiles.length; i++) {
                var slice = {
                        attrs: {
                            fill: colors[i]
                        }
                    };
                slice.min = quantiles[i];
                if (i < quantiles.length -1) {
                    slice.max = quantiles[i + 1];
                    slice.label = "Entre " + slice.min + " et " + slice.max + " décès *";
                } else {
                    slice.label = "Plus de " + slice.min + " décès *";
                }
                slices.push(slice);
            }
            for (var id in departments) {
                departments[id]['value'] = departments[id]['dc_par_habitants'];
                departments[id]['tooltip'] = {
                    "content": departments[id]['label'] + " : <b>" + departments[id]['dc'] + "</b> décès (<b>" + departments[id]['dc_par_habitants'] + "</b> pour 100 000 habitants)"
                };
                departments[id]['href'] = "/departement/" + departments[id]['insee'] + "#";
                if (departments[id]['insee'] === '{{ department }}') {
                    departments[id]['href'] = "/";
                    delete departments[id]['value'];
                    departments[id]['attrs'] = {
                        "fill": "#004a9b",
                    };
                }
            }
            $("#death_map_dep").mapael({
                "map": {
                    "name": "france_departments_domtom",
                    zoom: {
                        enabled: true,
                        maxLevel: 10
                    },
                    "defaultArea": {
                        "attrs": {
                            "fill": "#f4f4e8",
                            "stroke": "#ced8d0",
                        },
                        "attrsHover": {
                            "fill": "#004a9b",
                        },
                        "text": {
                            "attrs": {
                                "fill": "#505444"
                            },
                            "attrsHover": {
                                "fill": "#000",
                            }
                        }
                    }
                },
                "legend": {
                    "area": {
                        "marginBottom": 20,
                        "slices": slices
                    }
                },
                "areas": departments
            });
        });
    </script>
    
    <!-- rate dc map departments-->
    <script type="text/javascript">
        $(function() {
            // Init map
            var departments = {{ overall_departments_data_r_dc_rad|safe }};
            var quantiles = {{ overall_departments_quantiles_r_dc_rad|safe }};
            quantiles = Object.values(quantiles);
            var slices = [
                    {"max": quantiles[0], "label": "Taux inférieur à " + quantiles[0], attrs: {fill: '#D6F77F'}}
                ];
            colors = ["#f2f53a", '#df891a', '#e61919', '#680000', '#1d0303'] 
            for (var i = 0; i < quantiles.length; i++) {
                var slice = {
                        attrs: {
                            fill: colors[i]
                        }
                    };
                slice.min = quantiles[i];
                if (i < quantiles.length -1) {
                    slice.max = quantiles[i + 1];
                    slice.label = "Taux entre " + slice.min + " et " + slice.max;
                } else {
                    slice.label = "Taux supérieur à " + slice.min;
                }
                slices.push(slice);
            }
            for (var id in departments) {
                departments[id]['value'] = departments[id]['r_dc_rad'];
                departments[id]['tooltip'] = {
                    "content": departments[id]['label'] + " : <b>" + departments[id]['dc'] + "</b> décès, <b>" + departments[id]['rad'] + "</b> guérisons (Taux départemental : <b>" + departments[id]['r_dc_rad'] + "</b>)"
                };
                departments[id]['href'] = "/departement/" + departments[id]['insee'] + "#"; 
                if (departments[id]['insee'] === '{{ department }}') {
                    departments[id]['href'] = "/";
                    delete departments[id]['value'];
                    departments[id]['attrs'] = {
                        "fill": "#004a9b", 
                    };
                }
            }      
            $("#rate_death_map_dep").mapael({
                "map": {
                    "name": "france_departments_domtom",
                    zoom: {
                        enabled: true,
                        maxLevel: 10
                    },	
                    "defaultArea": {
                        "attrs": {
                            "fill": "#f4f4e8",
                            "stroke": "#ced8d0",
                        },
                        "attrsHover": {
                            "fill": "#004a9b",
                        },
                        "text": {
                            "attrs": {
                                "fill": "#505444"
                            },
                            "attrsHover": {
                                "fill": "#000",
                            }
                        }
                    }	
                },
                "legend": {
                    "area": {
                        "marginBottom": 20,
                        "slices": slices
                    }
                },
                "areas": departments
            });
        });
    </script>

    <!-- rad map departments -->
    <script type="text/javascript">
        $(function() {
            // Init map
            var departments = {{ overall_departments_data_rad|safe }};
            var quantiles = {{ overall_departments_quantiles_rad|safe }};
            quantiles = Object.values(quantiles);
            var slices = [
                {"max": quantiles[0], "label": "Moins de " + quantiles[0] + " guérisons *", attrs: {fill: "#FEB653"}}
                ];
            colors = ["#FED674", '#F5F50A', '#A4F905', '#06BF06', '#146806']  
            for (var i = 0; i < quantiles.length; i++) {
                var slice = {
                        attrs: {
                            fill: colors[i]
                        }
                    };
                slice.min = quantiles[i];
                if (i < quantiles.length -1) {
                    slice.max = quantiles[i + 1];
                    slice.label = "Entre " + slice.min + " et " + slice.max + " guérisons *";
                } else {
                    slice.label = "Plus de " + slice.min + " guérisons *";
                }
                slices.push(slice);
            }
            for (var id in departments) {
                departments[id]['value'] = departments[id]['rad_par_habitants'];
                departments[id]['tooltip'] = {
                    "content": departments[id]['label'] + " : <b>" + departments[id]['rad'] + "</b> guérisons (<b>" + departments[id]['rad_par_habitants'] + "</b> pour 100 000 habitants)"
                };
                departments[id]['href'] = "/departement/" + departments[id]['insee'] + "#"; 
                if (departments[id]['insee'] === '{{ department }}') {
                    departments[id]['href'] = "/";
                    delete departments[id]['value'];
                    departments[id]['attrs'] = {
                        "fill": "#004a9b", 
                    };
                }
            }   
            $("#rad_map_dep").mapael({
                "map": {
                    "name": "france_departments_domtom",
                    zoom: {
                        enabled: true,
                        maxLevel: 10
                    },
                
                    "defaultArea": {
                        "attrs": {
                            "fill": "#f4f4e8",
                            "stroke": "#ced8d0",
                        },
                        "attrsHover": {
                            "fill": "#004a9b",
                        },
                        "text": {
                            "attrs": {
                                "fill": "#505444"
                            },
                            "attrsHover": {
                                "fill": "#000",
                            }
                        }
                    }	
                },
                "legend": {
                    "area": {
                        "marginBottom": 20,
                        "slices": slices
                    }
                },
                "areas": departments
            });
        });
    </script>
        
    <!-- hosp map departments-->
    <script type="text/javascript">
        $(function() {
            // Init map
            var departments = {{ overall_departments_data_hosp|safe }};
            var quantiles = {{ overall_departments_quantiles_hosp|safe }};
            quantiles = Object.values(quantiles);
            var slices = [
                    {"max": quantiles[0], "label": "Moins de " + quantiles[0] + " hospitalisations *", attrs: {fill: "#D6F77F"}}
                ];
            colors = ["#f2f53a", '#df891a', '#e61919', '#680000', '#1d0303']
            for (var i = 0; i < quantiles.length; i++) {
                var slice = {
                        attrs: {
                            fill: colors[i]
                        }
                    };
                slice.min = quantiles[i];
                if (i < quantiles.length -1) {
                    slice.max = quantiles[i + 1];
                    slice.label = "Entre " + slice.min + " et " + slice.max + " hospitalisations *";
                } else {
                    slice.label = "Plus de " + slice.min + " hospitalisations *";
                }
                slices.push(slice);
            }
            for (var id in departments) {
                departments[id]['value'] = departments[id]['hosp_par_habitants'];
                departments[id]['tooltip'] = {
                    "content": departments[id]['label'] + " : <b>" + departments[id]['hosp'] + "</b> hospitalisations (<b>" + departments[id]['hosp_par_habitants'] + "</b> pour 100 000 habitants)"
                };
                departments[id]['href'] = "/departement/" + departments[id]['insee'] + "#"; 
                if (departments[id]['insee'] === '{{ department }}') {
                    departments[id]['href'] = "/";
                    delete departments[id]['value'];
                    departments[id]['attrs'] = {
                        "fill": "#004a9b", 
                    };
                }
            }        
            $("#hosp_map_dep").mapael({
                "map": {
                    "name": "france_departments_domtom",
                    zoom: {
                        enabled: true,
                        maxLevel: 10
                    },		
                    "defaultArea": {
                        "attrs": {
                            "fill": "#f4f4e8",
                            "stroke": "#ced8d0",
                        },
                        "attrsHover": {
                            "fill": "#004a9b",
                        },
                        "text": {
                            "attrs": {
                                "fill": "#505444"
                            },
                            "attrsHover": {
                                "fill": "#000",
                            }
                        }
                    }	
                },			
                "legend": {
                    "area": {
                        "marginBottom": 20,
                        "slices": slices
                    }
                },
                "areas": departments
            });
        });
    </script>
    
    <!-- rea map departments-->
    <script type="text/javascript">
        $(function() {
            // Init map
            var departments = {{ overall_departments_data_rea|safe }};
            var quantiles = {{ overall_departments_quantiles_rea|safe }};
            quantiles = Object.values(quantiles);
            var slices = [
                    {"max": quantiles[0], "label": quantiles[0] + " réanimations *", attrs: {fill: "#D6F77F"}}
                ];
            colors = ["#f2f53a", '#df891a', '#e61919', '#680000', '#1d0303']
            for (var i = 0; i < quantiles.length; i++) {
                var slice = {
                        attrs: {
                            fill: colors[i]
                        }
                    };
                slice.min = quantiles[i];
                if (i < quantiles.length -1) {
                    slice.max = quantiles[i + 1];
                    slice.label = "Entre " + slice.min + " et " + slice.max + " réanimations *";
                } else {
                    slice.label = "Plus de " + slice.min + " réanimations *";
                }
                if (i == 0) {
                    slice.max = quantiles[i + 1];
                    slice.label = "Moins de " + slice.max + " réanimations *";
                }           
                slices.push(slice);
            }
            for (var id in departments) {
                departments[id]['value'] = departments[id]['rea_par_habitants'];
                departments[id]['tooltip'] = {
                    "content": departments[id]['label'] + " : <b>" + departments[id]['rea'] + "</b> réanimations (<b>" + departments[id]['rea_par_habitants'] + "</b> pour 100 000 habitants)"
                };
                departments[id]['href'] = "/departement/" + departments[id]['insee'] + "#"; 
                if (departments[id]['insee'] === '{{ department }}') {
                    departments[id]['href'] = "/";
                    delete departments[id]['value'];
                    departments[id]['attrs'] = {
                        "fill": "#004a9b", 
                    };
                }
            }       
            $("#rea_map_dep").mapael({
                "map": {
                    "name": "france_departments_domtom",
                    zoom: {
                        enabled: true,
                        maxLevel: 10
                    },					
                    "defaultArea": {
                        "attrs": {
                            "fill": "#f4f4e8",
                            "stroke": "#ced8d0",
                        },
                        "attrsHover": {
                            "fill": "#004a9b",
                        },
                        "text": {
                            "attrs": {
                                "fill": "#505444"
                            },
                            "attrsHover": {
                                "fill": "#000",
                            }
                        }
                    }	
                },	
                "legend": {
                    "area": {
                        "marginBottom": 20,
                        "slices": slices
                    }
                },
                "areas": departments
            });
        });
    </script>

    <!-- charts -->
    <script type="text/javascript">
        // Init charts
        var plotlyConfig = {
                "locale": "fr",
                "modeBarButtonsToRemove": ["sendDataToCloud", "autoScale2d", "hoverClosestCartesian", "hoverCompareCartesian", "lasso2d", "select2d"],
                "displaylogo": false,
                "showTips": false,
            };

        var graphs = {{ graphJSON | safe }};

        for(var i in graphs) {
            Plotly.plot(
                graphs[i].id, // the ID of the div, created above
                graphs[i].data,
                graphs[i].layout || {}, 
                plotlyConfig);
        }
    </script>

    <!-- charts pca-->
    <script type="text/javascript">
        var graphs = {{ graphJSONquadratics["graphJSON"] | safe }};

        for(var i in graphs) {
            Plotly.plot(
                graphs[i].id, // the ID of the div, created above
                graphs[i].data,
                graphs[i].layout || {}, 
                plotlyConfig);
        }
    </script>

    <!-- charts pca-->
    <script type="text/javascript">
        var graphs = {{ graphJSONquadratics_reg["graphJSON"] | safe }};

        for(var i in graphs) {
            Plotly.plot(
                graphs[i].id + '_reg', // the ID of the div, created above
                graphs[i].data,
                graphs[i].layout || {}, 
                plotlyConfig);
        }
    </script>
    
{% endblock %}